<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AiaxStock ‚Äì Owner Panel</title>

  <style>
    *{box-sizing:border-box;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto}
    body{margin:0;background:linear-gradient(135deg,#f7e8ff,#eaf3ff);color:#333}

    header{
      position:sticky; top:0; z-index:10;
      background:#fff; padding:12px 16px;
      box-shadow:0 4px 16px rgba(0,0,0,.08);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .head-left{display:flex; flex-direction:column; gap:2px}
    .head-title{font-weight:900}
    .head-sub{font-size:12px;color:#777}

    .pill{
      font-size:12px;font-weight:800;
      padding:8px 10px;border-radius:999px;border:none;
      background:linear-gradient(135deg,#ff6fb1,#ff9bd0);
      color:#fff;
      box-shadow:0 8px 20px rgba(255,111,177,.25);
    }

    main{padding:16px 16px 120px}

    .card{
      background:#fff;border-radius:16px;padding:16px;
      box-shadow:0 10px 30px rgba(0,0,0,.08);
      margin-bottom:16px;
    }
    .title{font-weight:900;font-size:18px;margin:0 0 10px}
    .muted{color:#777;font-size:13px;margin:0}

    .statusbar{
      margin:10px 0 0;
      padding:10px 12px;border-radius:12px;
      background:#f7f7f7;
      font-size:13px;
      display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;
    }
    .badge{
      padding:4px 8px;border-radius:999px;font-weight:800;font-size:12px;
      background:#eaeaea;color:#333;
    }
    .badge.ok{background:#e7fff0;color:#0d7a3b}
    .badge.err{background:#ffe7ee;color:#b0002a}
    .badge.wait{background:#fff6dd;color:#8a5b00}

    .stats{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .stat{
      padding:14px;border-radius:14px;background:#fafafa;
      display:flex;align-items:center;gap:10px;font-weight:800;
    }
    .stat span{font-size:22px}
    .stat small{display:block;color:#777;font-weight:700}

    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{padding:10px;border-bottom:1px solid #eee;text-align:left}

    .content-panel{display:none}
    .content-panel.active{display:block}

    .bottom-nav{
      position:fixed;left:12px;right:12px;bottom:12px;z-index:99;
      background:rgba(255,255,255,.92);backdrop-filter: blur(10px);
      border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.2);
      display:flex;
    }
    .nav-btn{
      flex:1;border:none;background:none;padding:10px 6px;
      font-weight:900;color:#777;
    }
    .nav-btn.active{
      background:linear-gradient(135deg,#ff6fb1,#ff9bd0);
      color:#fff;border-radius:18px;
    }

    .btn-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .btn-ghost{
      border:2px solid #ffd0e5;background:#fff;color:#d1005a;
      padding:10px 12px;border-radius:14px;font-weight:900;
    }

    .note{
      font-size:12px;color:#666;background:#f8f8f8;
      padding:10px 12px;border-radius:12px;margin-top:10px;
    }
  </style>
</head>

<body>

<header>
  <div class="head-left">
    <div class="head-title">üìä AiaxStock ‚Äì Owner Panel</div>
    <div class="head-sub" id="subline">Waiting for data‚Ä¶</div>
  </div>
  <button class="pill" id="btnRefresh">‚Üª Refresh</button>
</header>

<main>

  <!-- DASHBOARD -->
  <section id="dashboard" class="content-panel active">
    <div class="card">
      <h2 class="title">Dashboard Overview</h2>
      <p class="muted">Stable mode: kahit may error sa data, hindi blank.</p>

      <div class="statusbar">
        <div>
          <span class="badge wait" id="badgeStatus">LOADING</span>
          <span style="margin-left:8px" id="txtStatus">Fetching data.json‚Ä¶</span>
        </div>
        <div>
          <span class="badge" id="badgeUpdated">Updated: ‚Äî</span>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn-ghost" id="btnRetry">Retry Load</button>
        <button class="btn-ghost" id="btnTest">Test Fallback</button>
      </div>

      <div class="note">
        Tip: siguraduhin may <b>data.json</b> sa parehong folder ng index.html sa GitHub Pages.
      </div>
    </div>

    <div class="card">
      <div class="stats">
        <div class="stat"><span>ü§ñ</span><div><div>TG Sales</div><small id="tgSales">0</small></div></div>
        <div class="stat"><span>‚úçÔ∏è</span><div><div>Manual Sales</div><small id="manualSales">0</small></div></div>
        <div class="stat"><span>üì¶</span><div><div>Stocks</div><small id="stocks">0</small></div></div>
        <div class="stat"><span>üí∞</span><div><div>Revenue</div><small>‚Ç±<span id="revenue">0</span></small></div></div>
      </div>
    </div>

    <div class="card">
      <h2 class="title">Recent Sales</h2>
      <table>
        <tbody id="recentSales">
          <tr><td>Waiting‚Ä¶</td></tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- SALES -->
  <section id="sales" class="content-panel">
    <div class="card">
      <h2 class="title">All Sales</h2>
      <p class="muted">Next step natin dito: full table + filters + pagination.</p>
    </div>
  </section>

  <!-- STOCK -->
  <section id="stock" class="content-panel">
    <div class="card">
      <h2 class="title">Stock</h2>
      <p class="muted">Next step natin dito: basic stock list + mark used.</p>
    </div>
  </section>

  <!-- PREMIUM -->
  <section id="premium" class="content-panel">
    <div class="card">
      <h2 class="title">Premium Accounts</h2>
      <p class="muted">Next step natin dito: FIFO / aging (days in stock).</p>
    </div>
  </section>

</main>

<nav class="bottom-nav">
  <button class="nav-btn active" data-target="dashboard">üè†<br>Home</button>
  <button class="nav-btn" data-target="sales">üßæ<br>Sales</button>
  <button class="nav-btn" data-target="stock">üì¶<br>Stock</button>
  <button class="nav-btn" data-target="premium">‚≠ê<br>Premium</button>
</nav>

<script>
  // ---- NAV
  document.querySelectorAll('.nav-btn').forEach(btn=>{
    btn.onclick=()=>{
      document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      document.querySelectorAll('.content-panel').forEach(p=>p.classList.remove('active'));
      document.getElementById(btn.dataset.target).classList.add('active');
    }
  });

  // ---- UI helpers
  const el = (id)=>document.getElementById(id);

  function setStatus(type, msg){
    const b = el('badgeStatus');
    b.classList.remove('ok','err','wait');
    if(type==='ok') b.classList.add('ok');
    if(type==='err') b.classList.add('err');
    if(type==='wait') b.classList.add('wait');
    b.textContent = type.toUpperCase();
    el('txtStatus').textContent = msg;
    el('subline').textContent = msg;
  }

  function renderFallback(){
    el('tgSales').textContent = 0;
    el('manualSales').textContent = 0;
    el('stocks').textContent = 0;
    el('revenue').textContent = 0;
    el('recentSales').innerHTML = '<tr><td>No records (fallback)</td></tr>';
    el('badgeUpdated').textContent = 'Updated: ‚Äî';
  }

  function renderData(d){
    const stats = (d && d.stats) ? d.stats : {};
    el('tgSales').textContent = stats.tg_sales ?? 0;
    el('manualSales').textContent = stats.manual_sales ?? 0;
    el('stocks').textContent = stats.available_stocks ?? 0;
    el('revenue').textContent = stats.revenue ?? 0;

    const updated = d.updated_at || d.updated || null;
    el('badgeUpdated').textContent = 'Updated: ' + (updated || '‚Äî');

    const rs = el('recentSales');
    rs.innerHTML = '';
    const list = Array.isArray(d.recent_sales) ? d.recent_sales : [];
    if(!list.length){
      rs.innerHTML = '<tr><td>No records</td></tr>';
    } else {
      list.slice(0,8).forEach(x=>{
        const buyer = x.buyer || x.buyer_name || x.username || '‚Äî';
        const product = x.product || x.product_name || '‚Äî';
        const amount = x.amount ?? x.price ?? '‚Äî';
        rs.innerHTML += `<tr><td>${buyer}</td><td>${product}</td><td>${amount}</td></tr>`;
      });
    }
  }

  // ---- stable loader with retries
  async function loadData({retries=2}={}){
    setStatus('wait','Fetching data.json‚Ä¶');
    try{
      const res = await fetch('./data.json?ts=' + Date.now(), { cache:'no-store' });
      if(!res.ok){
        throw new Error('HTTP ' + res.status + ' (data.json missing?)');
      }
      const d = await res.json();
      renderData(d);
      setStatus('ok','Loaded successfully.');
      return true;
    } catch(err){
      renderFallback();
      setStatus('err','Load failed: ' + err.message);
      if(retries > 0){
        setStatus('wait','Retrying‚Ä¶ ('+retries+')');
        await new Promise(r=>setTimeout(r, 900));
        return loadData({retries: retries-1});
      }
      return false;
    }
  }

  // buttons
  el('btnRefresh').onclick = ()=>loadData({retries:2});
  el('btnRetry').onclick = ()=>loadData({retries:3});
  el('btnTest').onclick = ()=>{
    // simulate broken data
    renderFallback();
    setStatus('err','Test mode: showing fallback (no crash).');
  };

  // initial
  renderFallback();
  loadData({retries:2});
</script>

</body>
</html>